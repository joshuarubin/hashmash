// Generated by CoffeeScript 1.6.3
(function() {
  var HASH_CASH_NUM_BITS, HashCash, MAX_TESTS, hc, resource, results, stop, test, updateData;

  HASH_CASH_NUM_BITS = 19;

  MAX_TESTS = 100;

  resource = "zvelo.com";

  HashCash = hashcash.HashCash;

  hc = new HashCash(HASH_CASH_NUM_BITS);

  stop = false;

  results = {
    num: 0,
    duration: 0,
    min: void 0,
    max: void 0
  };

  $("#complexity").text(HASH_CASH_NUM_BITS);

  window.start = function() {
    stop = false;
    $("#status").text("running");
    return test();
  };

  window.stop = function() {
    if (results.num >= MAX_TESTS) {
      return;
    }
    $("#status").text("stopping");
    return stop = true;
  };

  updateData = function(start, hashcash) {
    var averageDuration, duration, valid;
    valid = hc.validate(hashcash);
    duration = (new Date() - start) / 1000;
    if ((results.min == null) || duration < results.min) {
      results.min = duration;
    }
    if ((results.max == null) || duration > results.max) {
      results.max = duration;
    }
    results.duration += duration;
    results.num += 1;
    averageDuration = results.duration / results.num;
    $("#test-number").text(results.num);
    $("#average-duration").text(averageDuration);
    $("#minimum-duration").text(results.min);
    $("#maximum-duration").text(results.max);
    console.log("test", results.num, hashcash, HashCash.hash(hashcash), "valid", valid, "duration", duration);
    if (stop) {
      return $("#status").text("stopped");
    } else if (results.num < MAX_TESTS) {
      return test();
    }
  };

  test = function() {
    var start;
    if (!resource.length) {
      return;
    }
    start = new Date();
    hc = new HashCash(HASH_CASH_NUM_BITS, "../browser/hashcash_worker.min.js");
    return hc.generate(resource, function(hashcash) {
      return updateData(start, hashcash);
    });
  };

}).call(this);
