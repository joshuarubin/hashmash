/*
 * zvelo HashCash Javascript Library
 *
 * Copyright 2013 zvelo, Inc. All Rights Reserved
 *
 * SHA-1 implementation in JavaScript
 * (c) Chris Veness 2002-2010
 * www.movable-type.co.uk
 *  - http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html
 *  - http://csrc.nist.gov/groups/ST/toolkit/examples.html
 */
!function(e){if("function"==typeof bootstrap)bootstrap("hashcash",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeHashcash=e}else"undefined"!=typeof window?window.hashcash=e():global.hashcash=e()}(function(){var define,ses,bootstrap,module,exports;return function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module,exports){exports.spawn=function(){};exports.exec=function(){}},{}],2:[function(require,module,exports){!function(__dirname){!function(){var HashCash,browserGenerate,buildDate,childProcess,nextPos,nodeGenerate,numLeading0s,sha1,webWorkerGenerate;sha1=require("./sha1");childProcess=require("child_process");numLeading0s=function(hex_str){var curNum,num,pos,_i,_ref;num=0;for(pos=_i=0,_ref=hex_str.length-1;0<=_ref?_i<=_ref:_i>=_ref;pos=0<=_ref?++_i:--_i){curNum=parseInt(hex_str[pos],16);if(isNaN(curNum)){break}switch(curNum){case 0:num+=4;break;case 1:return num+3;case 2:case 3:return num+2;case 4:case 5:case 6:case 7:return num+1;default:return num}}return num};buildDate=function(date){if(typeof date==="string"){if(date.length!==6){return null}return date}if(typeof date!=="number"){return null}return buildDate(""+date)};nodeGenerate=function(data,callback){var worker;worker=childProcess.fork(__dirname+"/worker.js");worker.on("message",function(test){worker.disconnect();return callback(test)});return worker.send(data)};webWorkerGenerate=function(data,callback){var worker;worker=new Worker(data.file);worker.onmessage=function(event){worker.terminate();return callback(event.data)};return worker.postMessage(data)};browserGenerate=function(data,callback){var RUNTIME_MAX,TIMEOUT,timeoutFn;RUNTIME_MAX=99;TIMEOUT=1;timeoutFn=function(){var start;start=new Date;while(!(data.result!=null||new Date-start>=RUNTIME_MAX)){HashCash.testSha(data)}if(data.result!=null){return callback(data.result)}else{return setTimeout(timeoutFn,TIMEOUT)}};return setTimeout(timeoutFn,TIMEOUT)};nextPos=function(str,pos){pos.start=pos.end+1;if(pos.start===str.length){return false}pos.end=str.indexOf(":",pos.start);if(pos.end===-1){return false}if(pos.end===pos.start){return false}return true};HashCash=function(){HashCash.VERSION=1;HashCash.MIN_BITS=16;HashCash.hash=sha1.hash;HashCash.genDate=function(){var dd,mm,now,yy;now=new Date;yy=("0"+(now.getYear()-100)).slice(-2);mm=("0"+(now.getMonth()+1)).slice(-2);dd=("0"+now.getDate()).slice(-2);return""+yy+mm+dd};HashCash.buildString=function(parts){var date,ret;ret="";if(parts.version==null){return ret}ret+=""+parts.version+":";if(parts.bits==null){return ret}ret+=""+parts.bits+":";if(parts.date==null){return ret}date=buildDate(parts.date);if(date==null){return ret}ret+=""+date+":";if(parts.resource==null){return ret}ret+=""+parts.resource+":";if(parts.rand==null){return ret}ret+=parts.rand;if(parts.counter==null){return ret}return ret+=":"+parts.counter};HashCash.testSha=function(data){var sha,test;test=""+data.challenge+":"+data.counter;sha=sha1.hash(test);if(numLeading0s(sha)>=data.bits){data.result=test}else{data.counter+=1}return void 0};HashCash.parse=function(str){var counterEnd,data,pos;if(str==null){return null}data={};pos={start:0,end:-1,length:function(){return this.end-this.start}};if(!nextPos(str,pos)){return null}data.version=parseInt(str.substr(pos.start,pos.length()),10);if(isNaN(data.version)){return null}if(!nextPos(str,pos)){return null}data.bits=parseInt(str.substr(pos.start,pos.length()),10);if(isNaN(data.bits)){return null}if(!nextPos(str,pos)){return null}data.date=parseInt(str.substr(pos.start,pos.length()),10);if(isNaN(data.date)){return null}if(!nextPos(str,pos)){return null}data.resource=str.substr(pos.start,pos.length());if(!data.resource.length){return null}if(!nextPos(str,pos)){return null}data.rand=str.substr(pos.start,pos.length());if(!data.rand.length){return null}nextPos(str,pos);counterEnd=(pos.end===-1?str.length:pos.end)-pos.start;data.counter=parseInt(str.substr(pos.start,counterEnd),10);if(isNaN(data.counter)){return null}return data};function HashCash(bits,workerFile){this.bits=bits;this.workerFile=workerFile;if(this.bits<HashCash.MIN_BITS){this.bits=HashCash.MIN_BITS}}HashCash.prototype.generate=function(resource,callback){var data,parts;parts={version:HashCash.VERSION,bits:this.bits,date:HashCash.genDate(),resource:resource,rand:Math.random().toString(36).substr(2)};data={file:this.workerFile,challenge:HashCash.buildString(parts),counter:0,bits:parts.bits};if(typeof window==="undefined"||window===null){return nodeGenerate(data,callback)}else if(typeof Worker!=="undefined"&&Worker!==null&&this.workerFile!=null){return webWorkerGenerate(data,callback)}else{return browserGenerate(data,callback)}};HashCash.prototype.validate=function(str){var data,now;if(str==null){return false}if(this.bits==null){return false}data=HashCash.parse(str);if(data==null){return false}if(data.bits<this.bits){return false}if(data.bits<HashCash.MIN_BITS){return false}if(data.version!==HashCash.VERSION){return false}now=HashCash.genDate();if(data.date<now-1||data.date>now+1){return false}return numLeading0s(sha1.hash(str))>=data.bits};return HashCash}();exports.HashCash=HashCash}.call(this)}("/")},{child_process:1,"./sha1":3}],3:[function(require,module,exports){!function(){var ROTL,f,toHexStr;ROTL=function(x,n){return x<<n|x>>>32-n};toHexStr=function(n){var i,s,v,_i;s="";for(i=_i=7;_i>=0;i=--_i){v=n>>>i*4&15;s+=v.toString(16)}return s};f=function(s,x,y,z){switch(s){case 0:return x&y^~x&z;case 1:return x^y^z;case 2:return x&y^x&z^y&z;case 3:return x^y^z}};exports.hash=function(msg){var H0,H1,H2,H3,H4,K,M,N,T,TWO_TO_THIRTY_TWO,W,a,b,c,d,e,i,j,l,s,t,_i,_j,_k,_l,_m,_n,_ref,_ref1;K=[1518500249,1859775393,2400959708,3395469782];msg+=String.fromCharCode(128);l=msg.length/4+2;N=Math.ceil(l/16);M=[];for(i=_i=0,_ref=N-1;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i){M[i]=[];for(j=_j=0;_j<=15;j=++_j){M[i][j]=msg.charCodeAt(i*64+j*4+0)<<24|msg.charCodeAt(i*64+j*4+1)<<16|msg.charCodeAt(i*64+j*4+2)<<8|msg.charCodeAt(i*64+j*4+3)<<0}}TWO_TO_THIRTY_TWO=4294967296;M[N-1][14]=(msg.length-1)*8/TWO_TO_THIRTY_TWO;M[N-1][14]=Math.floor(M[N-1][14]);M[N-1][15]=(msg.length-1)*8&4294967295;H0=1732584193;H1=4023233417;H2=2562383102;H3=271733878;H4=3285377520;W=[];for(i=_k=0,_ref1=N-1;0<=_ref1?_k<=_ref1:_k>=_ref1;i=0<=_ref1?++_k:--_k){for(t=_l=0;_l<=15;t=++_l){W[t]=M[i][t]}for(t=_m=16;_m<=79;t=++_m){W[t]=ROTL(W[t-3]^W[t-8]^W[t-14]^W[t-16],1)}a=H0;b=H1;c=H2;d=H3;e=H4;for(t=_n=0;_n<=79;t=++_n){s=Math.floor(t/20);T=ROTL(a,5)+f(s,b,c,d)+e+K[s]+W[t]&4294967295;e=d;d=c;c=ROTL(b,30);b=a;a=T}H0=H0+a&4294967295;H1=H1+b&4294967295;H2=H2+c&4294967295;H3=H3+d&4294967295;H4=H4+e&4294967295}return toHexStr(H0)+toHexStr(H1)+toHexStr(H2)+toHexStr(H3)+toHexStr(H4)}}.call(this)},{}]},{},[2])(2)});